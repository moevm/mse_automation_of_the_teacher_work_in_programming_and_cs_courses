import argparse
import os

os.chdir(os.path.join('C:\\', 'Users', 'nosov', 'PycharmProjects', 'autocheck_stepic', 'src'))

from automation_of_work_for_stepic.app import create_app

my_app = create_app()

file_needs_for_app = ['stepic_client.json', 'private key for GoogleAPI.json', 'config.json']


def correct_path(path: str):
    if os.path.isdir(path) and all([os.path.isfile(os.path.join(path, file)) for file in file_needs_for_app]):
        return path
    else:
        raise argparse.ArgumentTypeError(
            f'Error: run_applications: the path {path} must specify the directory with\n \
            stepic_client.json\n \
            private key for GoogleAPI\n \
            config.json')


if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        description='Run application for automation of work for stepic.',
        epilog='')

    parser.add_argument(
        'directory',
        help='the path to the resources folder (with "stepic_client.json\n \
            private key for GoogleAPI.json\n \
            config.json',
        type=correct_path)

    args = parser.parse_args()
    os.chdir(args.directory)

    my_app.run()